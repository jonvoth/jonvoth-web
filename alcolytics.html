<!doctype html>
<html class="no-js" lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<title>Drink Tracker Dashboard</title>
	<meta name="robots" content="noindex, nofollow">	

	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	
	<link href='https://fonts.googleapis.com/css?family=Josefin+Slab:600' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="css/style.css">
	<link rel="icon" href="favicon.ico">
</head>
<body class="alcolytics-dashboard-body">
	<div id="alcolytics_dashboard" class="alcolytics-dashboard-container">
		<h1>Drink Dashboard</h1>
		<section id="averages" class="averages-display-container">
			<div id="average_7_days" class="average-display">
				<h3>7 Days</h3>
				<p id="average_7_days_value">?</p>
			</div>
			<div id="average_30_days" class="average-display">
				<h3>30 Days</h3>
				<p id="average_30_days_value">?</p>
			</div>
			<div id="average_all_time" class="average-display">
				<h3>All Time</h3>
				<p id="average_all_time_value">?</p>
			</div>
		</section>
		<section id="drink_log" class="drink-log-container">
			<h2>Recent Drinks</h2>
			<table class="drink-log-table">
				<thead>
					<tr>
						<th>Time</th>
						<th>ABV</th>
						<th>Volume</th>
					</tr>
				</thead>
				<tbody id="drink_log_table_body"></tbody>
			</table>
		</section>
	</div>

	<script>
		function populateDisplay(rawData){
			//Populate recent drinks table
			rawData.sort(function(a,b){
				if(a.timestamp > b.timestamp){
					return -1;
				}else if(b.timestamp > a.timestamp){
					return 1;
				}
				return 0;
			});
			let tableBodyElement = document.getElementById('drink_log_table_body');
			var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
			for(let i = 0; i < 5; i+= 1){
				let thisRowElement = document.createElement('tr');
				let thisTimestampDate = new Date(rawData[i].timestamp);
				let thisFormattedTimestamp = monthNames[thisTimestampDate.getMonth()] + ' ' + thisTimestampDate.getDay() + ', ' + thisTimestampDate.getHours() + ':' + thisTimestampDate.getMinutes();
				thisRowElement.innerHTML = '<td>'+thisFormattedTimestamp+'</td><td>'+rawData[i].volume+'</td><td>'+rawData[i].abv+'</td>';
				tableBodyElement.appendChild(thisRowElement);
			}

			//Calculte averages
			function getAverageForData(dataArray){
				let count = dataArray.length;
				let total = 0;
				for(let i = 0; i < count; i += 1){
					total += dataArray[i].gramsOfAlcohol;
				}
				return Math.round(total/count);
			}

			function getClassNameForAverage(averageValue){
				if(averageValue >= goalHigh){
					return 'goal-high';
				} else if(averageValue > goalMed && averageValue < goalHigh){
					return 'goal-medium';
				} else {
					return 'goal-on';
				}
			}

			//Calculate 7-day average
			let trimmed7DayData = rawData.slice(0,Math.ceil(rawData.length / 2)); //TODO: get only items from last 7 days
			let average7Day = getAverageForData(trimmed7DayData);
			document.getElementById('average_7_days').classList.add(getClassNameForAverage(average7Day));
			document.getElementById('average_7_days_value').innerHTML = average7Day;

			//Calculate 30-day average
			let trimmed30DayData = rawData.slice(Math.ceil(rawData.length / 2)); //TODO: get only items from last 30 days
			let average30Day = 22;
			document.getElementById('average_30_days').classList.add(getClassNameForAverage(average30Day));
			document.getElementById('average_30_days_value').innerHTML = average30Day;

			//Calculate all time average
			let averageAllTime = getAverageForData(rawData);
			document.getElementById('average_all_time').classList.add(getClassNameForAverage(averageAllTime));
			document.getElementById('average_all_time_value').innerHTML = averageAllTime;
		}

		let dataFromAPI = [
			{
				timestamp: 1547166879050,
				abv: 7,
				volume: 16,
				gramsOfAlcohol: 26.141459836800003
			},
			{
				timestamp: 1547166879051,
				abv: 7,
				volume: 16,
				gramsOfAlcohol: 6.141459836800003
			},
			{
				timestamp: 1547166879052,
				abv: 40,
				volume: 2,
				gramsOfAlcohol: 18.672471312000003
			},
			{
				timestamp: 1547166879053,
				abv: 7,
				volume: 16,
				gramsOfAlcohol: 26.141459836800003
			},
			{
				timestamp: 1547166879054,
				abv: 40,
				volume: 2,
				gramsOfAlcohol: 10.672471312000003
			},
			{
				timestamp: 1547166879055,
				abv: 7,
				volume: 16,
				gramsOfAlcohol: 8.141459836800003
			}
		];
		let goalHigh = 20;
		let goalMed = 10;
		populateDisplay(dataFromAPI);
	</script>
</body>
</html>